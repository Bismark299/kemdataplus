<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Documentation - KemDataplus</title>
    <link rel="stylesheet" href="../public/css/dashboard.css">
    <script src="https://kit.fontawesome.com/56c0d51fb9.js" crossorigin="anonymous"></script>
    <style>
        .api-container {
            max-width: 1000px;
            margin: 30px auto;
            padding: 0 20px;
        }
        .api-header {
            background: linear-gradient(135deg, #024959 0%, #036c7f 100%);
            color: white;
            padding: 40px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .api-header h1 {
            margin: 0 0 10px 0;
            font-size: 2rem;
        }
        .api-header p {
            margin: 0;
            opacity: 0.9;
        }
        .api-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        .api-section h2 {
            color: #024959;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #F2C12E;
        }
        .api-section h3 {
            color: #024959;
            margin: 25px 0 15px;
        }
        .endpoint {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #F2C12E;
        }
        .endpoint-method {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.85rem;
            margin-right: 10px;
        }
        .method-get { background: #61affe; color: white; }
        .method-post { background: #49cc90; color: white; }
        .method-put { background: #fca130; color: white; }
        .method-delete { background: #f93e3e; color: white; }
        .endpoint-url {
            font-family: monospace;
            font-size: 0.95rem;
            color: #333;
        }
        .endpoint-description {
            margin-top: 10px;
            color: #666;
            font-size: 0.9rem;
        }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: monospace;
            font-size: 0.85rem;
            margin: 15px 0;
        }
        .api-key-section {
            background: #fffaf0;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #F2C12E;
            margin-bottom: 20px;
        }
        .api-key-display {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 15px;
        }
        .api-key-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: monospace;
            background: #fff;
        }
        .btn-copy {
            padding: 12px 20px;
            background: #024959;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        .btn-copy:hover {
            background: #F2C12E;
            color: #024959;
        }
        .btn-generate {
            padding: 12px 20px;
            background: #F2C12E;
            color: #024959;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        .btn-generate:hover {
            background: #024959;
            color: white;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        table th, table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        table th {
            background: #024959;
            color: white;
        }
        
        /* Responsive Styles - Clean stacking like login page */
        @media (max-width: 900px) {
            .api-container {
                padding: 0 15px;
                margin: 20px auto;
            }
            
            .api-header {
                padding: 25px 20px;
                margin-bottom: 20px;
                border-radius: 10px;
            }
            
            .api-header h1 {
                font-size: 1.4rem;
            }
            
            .api-header p {
                font-size: 0.9rem;
            }
            
            .api-section {
                padding: 20px;
                border-radius: 10px;
                margin-bottom: 20px;
            }
            
            .api-key-display {
                flex-direction: column;
                gap: 10px;
            }
            
            .api-key-input {
                width: 100%;
            }
            
            .btn-copy, .btn-generate {
                width: 100%;
            }
            
            .code-block {
                font-size: 0.8rem;
                padding: 15px;
                overflow-x: auto;
            }
            
            table {
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 600px) {
            .api-container {
                padding: 0 10px;
                margin: 15px auto;
            }
            
            .api-header {
                padding: 20px 15px;
                border-radius: 8px;
                margin-bottom: 15px;
            }
            
            .api-header h1 {
                font-size: 1.2rem;
            }
            
            .api-header p {
                font-size: 0.85rem;
            }
            
            .api-section {
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 15px;
            }
            
            .api-section h2 {
                font-size: 1.1rem;
                margin-bottom: 15px;
            }
            
            .api-section h3 {
                font-size: 1rem;
            }
            
            .api-key-section p {
                font-size: 0.85rem;
            }
            
            .btn-copy, .btn-generate {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .endpoint {
                padding: 12px;
                flex-wrap: wrap;
            }
            
            .endpoint-method {
                padding: 4px 10px;
                font-size: 0.75rem;
            }
            
            .endpoint-url {
                font-size: 0.85rem;
                word-break: break-all;
            }
            
            .endpoint-description {
                width: 100%;
                margin-top: 8px;
            }
            
            .code-block {
                font-size: 0.75rem;
                padding: 12px;
            }
            
            table {
                font-size: 0.8rem;
            }
            
            table th, table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="background">
        <!-- HEADER -->
        <div class="header-container">
            <header>
                <div><a href="../public/dashboard.html"><img src="../public/img/kem.png" alt="KemDataplus" class="logo"></a></div>
                <input type="checkbox" id="check-box">
                <div class="nav-links">
                    <label for="check-box" class="menu-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                    </label>
                    <div class="nav-menu">
                        <div class="links">
                            <a href="../public/dashboard.html">Dashboard</a>
                            <a href="../public/dashboard.html#buy-bundles">Buy Bundles</a>
                            <a href="./orders.html">Orders</a>
                            <a href="./wallet.html">Wallet</a>
                            <a href="./mystore.html">My Store</a>
                            <a href="./api.html" class="active">API</a>
                            <a href="./profile.html">Profile</a>
                        </div>
                    </div>
                    <div class="profile-dropdown">
                        <img src="../public/img/kem.png" alt="Profile" class="profile-pic" id="profileBtn">
                        <div class="dropdown-menu" id="dropdownMenu">
                            <a href="./profile.html"><i class="fas fa-user"></i> My Profile</a>
                            <a href="./profile.html"><i class="fas fa-cog"></i> Settings</a>
                            <a href="./wallet.html"><i class="fas fa-wallet"></i> Wallet</a>
                            <hr>
                            <a href="#" onclick="logout(); return false;"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        </div>
                    </div>
                    <label for="check-box" class="close-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </label>
                </div>
            </header>
        </div>

        <!-- API CONTENT -->
        <div class="api-container">
            <div class="api-header">
                <h1><i class="fas fa-code"></i> API Documentation</h1>
                <p>Integrate KemDataplus services into your applications</p>
            </div>

            <!-- API KEY SECTION -->
            <div class="api-section">
                <h2><i class="fas fa-key"></i> Your API Key</h2>
                <div class="api-key-section">
                    <p><strong>Important:</strong> Keep your API key secure and never expose it in client-side code.</p>
                    <div class="api-key-display">
                        <input type="text" class="api-key-input" id="apiKey" placeholder="No API key generated yet" readonly>
                        <button class="btn-copy" onclick="copyApiKey()"><i class="fas fa-copy"></i> Copy</button>
                        <button class="btn-generate" onclick="generateNewKey()"><i class="fas fa-sync"></i> Regenerate</button>
                    </div>
                </div>
            </div>

            <!-- AUTHENTICATION -->
            <div class="api-section">
                <h2><i class="fas fa-lock"></i> Authentication</h2>
                <p>All API requests require authentication using your API key in the header:</p>
                <div class="code-block">
Authorization: Bearer YOUR_API_KEY
                </div>

                <h3>Base URL</h3>
                <div class="code-block" id="baseUrlDisplay">
Loading...
                </div>
            </div>

            <!-- ENDPOINTS -->
            <div class="api-section">
                <h2><i class="fas fa-route"></i> Endpoints</h2>

                <h3>Bundles</h3>
                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-url">/bundles</span>
                    <p class="endpoint-description">Get all available data bundles</p>
                </div>
                <div class="code-block">
// Response
{
  "success": true,
  "data": [
    {
      "id": "mtn-1gb",
      "network": "MTN",
      "size": "1GB",
      "price": 4.00,
      "validity": "30 days"
    }
  ]
}
                </div>

                <h3>Place Order</h3>
                <div class="endpoint">
                    <span class="endpoint-method method-post">POST</span>
                    <span class="endpoint-url">/orders</span>
                    <p class="endpoint-description">Create a new bundle order</p>
                </div>
                <div class="code-block">
// Request Body
{
  "phone": "0241234567",
  "bundle_id": "mtn-1gb",
  "quantity": 1
}

// Response
{
  "success": true,
  "data": {
    "order_id": "ORD-ABC12345",
    "status": "processing",
    "amount": 4.00
  }
}
                </div>

                <h3>Check Order Status</h3>
                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-url">/orders/{order_id}</span>
                    <p class="endpoint-description">Get order status and details</p>
                </div>

                <h3>Wallet Balance</h3>
                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-url">/wallet/balance</span>
                    <p class="endpoint-description">Get your current wallet balance</p>
                </div>

                <h3>Transaction History</h3>
                <div class="endpoint">
                    <span class="endpoint-method method-get">GET</span>
                    <span class="endpoint-url">/wallet/transactions</span>
                    <p class="endpoint-description">Get transaction history</p>
                </div>
            </div>

            <!-- ERROR CODES -->
            <div class="api-section">
                <h2><i class="fas fa-exclamation-triangle"></i> Error Codes</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Code</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>400</td>
                            <td>Bad Request - Invalid parameters</td>
                        </tr>
                        <tr>
                            <td>401</td>
                            <td>Unauthorized - Invalid API key</td>
                        </tr>
                        <tr>
                            <td>402</td>
                            <td>Insufficient Balance</td>
                        </tr>
                        <tr>
                            <td>404</td>
                            <td>Not Found - Resource doesn't exist</td>
                        </tr>
                        <tr>
                            <td>429</td>
                            <td>Rate Limited - Too many requests</td>
                        </tr>
                        <tr>
                            <td>500</td>
                            <td>Server Error</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- RATE LIMITS -->
            <div class="api-section">
                <h2><i class="fas fa-tachometer-alt"></i> Rate Limits</h2>
                <p>API requests are limited to:</p>
                <ul>
                    <li><strong>100 requests</strong> per minute</li>
                    <li><strong>5,000 requests</strong> per day</li>
                </ul>
                <p>Rate limit headers are included in all responses:</p>
                <div class="code-block">
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1609459200
                </div>
            </div>
        </div>
    </div>

    <script>
        // Auth check - redirect to login if not authenticated
        async function checkAuth() {
            try {
                const res = await fetch('/api/users/me', { credentials: 'include' });
                return res.ok;
            } catch (e) {
                return false;
            }
        }
        
        // Initialize page
        (async function() {
            const isAuthenticated = await checkAuth();
            if (!isAuthenticated) {
                window.location.href = './login.html';
                return;
            }
            
            // Set dynamic base URL
            const baseUrlDisplay = document.getElementById('baseUrlDisplay');
            if (baseUrlDisplay) {
                baseUrlDisplay.textContent = window.location.origin + '/api/v1';
            }
            
            // Load API key from user profile
            try {
                const res = await fetch('/api/users/me', { credentials: 'include' });
                if (res.ok) {
                    const user = await res.json();
                    if (user.apiKey) {
                        document.getElementById('apiKey').value = user.apiKey;
                    }
                }
            } catch (e) {
                console.warn('Could not load API key from profile');
            }
        })();
        
        // Profile dropdown toggle
        document.getElementById('profileBtn').addEventListener('click', function(e) {
            e.stopPropagation();
            const menu = document.getElementById('dropdownMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function() {
            document.getElementById('dropdownMenu').style.display = 'none';
        });

        function copyApiKey() {
            const apiKeyInput = document.getElementById('apiKey');
            if (!apiKeyInput.value || apiKeyInput.value.includes('No API key')) {
                alert('No API key to copy. Generate one first.');
                return;
            }
            apiKeyInput.select();
            apiKeyInput.setSelectionRange(0, 99999); // For mobile
            navigator.clipboard.writeText(apiKeyInput.value).then(function() {
                alert('API Key copied to clipboard!');
            }).catch(function() {
                // Fallback for older browsers
                document.execCommand('copy');
                alert('API Key copied to clipboard!');
            });
        }

        async function generateNewKey() {
            if (confirm('Are you sure you want to regenerate your API key? This will invalidate your current key.')) {
                const newKey = 'kdp_sk_' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
                document.getElementById('apiKey').value = newKey;
                // TODO: Save to user profile via API
                alert('New API key generated! Make sure to update your applications.');
            }
        }

        // Logout function
        async function logout() {
            try {
                await fetch('/api/auth/logout', { method: 'POST', credentials: 'include' });
            } catch (e) {}
            localStorage.removeItem('currentUser');
            window.location.href = './login.html';
        }
    </script>
</body>
</html>